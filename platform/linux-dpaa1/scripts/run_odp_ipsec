#!/bin/sh
#
# Live IPSec router test
#  - 2 interfaces interfaces
#  - Specify API mode on command line

#!/bin/sh

case "$HOSTNAME" in
        "t1040rdb" | "T1040RDB" )
                DEF_CFG_PATH=/usr/etc/odp_test_config_t4.xml
                IF1=fm0-mac1
                IF2=fm0-mac2
                ;;
        "p4080ds" | "P4080DS" )
                DEF_CFG_PATH=/usr/etc/odp_test_config_p4.xml
                IF1=fm1-mac1
                IF2=fm1-mac2
                ;;
        * )
                echo "Platform $HOSTNAME not supported"
                exit 0
                ;;
esac

export DEF_CFG_PATH=$DEF_CFG_PATH
export DEF_PCD_PATH=/usr/etc/odp_ipsec_pcd.xml

fmc -c $DEF_CFG_PATH -p $DEF_PCD_PATH -a

./odp_ipsec -i $IF1,$IF2 \
-r 192.168.111.2/32:$IF1:00.10.18.BA.E4.80 \
-r 192.168.222.2/32:$IF2:A0.36.9F.19.FE.15 \
-p 192.168.111.0/24:192.168.222.0/24:out:both \
-e 192.168.111.2:192.168.222.2:\
3des:201:656c8523255ccc23a66c1917aa0cf30991fce83532a4b224 \
-a 192.168.111.2:192.168.222.2:md5:200:a731649644c5dee92cbd9c2e7e188ee6 \
-p 192.168.222.0/24:192.168.111.0/24:in:both \
-e 192.168.222.2:192.168.111.2:\
3des:201:656c8523255ccc23a66c1917aa0cf30991fce83532a4b224 \
-a 192.168.222.2:192.168.111.2:md5:200:a731649644c5dee92cbd9c2e7e188ee6 \
-m 1 &
